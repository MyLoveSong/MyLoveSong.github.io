# 🗺️ 地图问题解决指南

## 🚨 地图加载不出来的常见原因

### 1. **Leaflet库未正确加载**
**症状**: 控制台显示 "Leaflet 库未加载" 错误
**解决方法**:
```html
<!-- 确保在HTML中正确引入Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
```

### 2. **地图容器元素不存在**
**症状**: 控制台显示 "找不到地图容器元素 #map" 错误
**解决方法**:
```html
<!-- 确保HTML中有地图容器 -->
<div id="map" style="width: 100%; height: 600px;"></div>
```

### 3. **脚本加载顺序问题**
**症状**: MapManager类未定义
**解决方法**:
```html
<!-- 确保先加载地图管理器，再初始化 -->
<script src="js/map-manager.js"></script>
<script>
    // 等待页面加载完成后再初始化
    document.addEventListener('DOMContentLoaded', function() {
        const mapManager = new MapManager();
        mapManager.setupTravelMap();
    });
</script>
```

## 🔧 调试步骤

### 步骤1: 检查控制台错误
打开浏览器开发者工具 (F12)，查看Console标签页的错误信息

### 步骤2: 使用调试函数
在控制台中输入以下命令：
```javascript
// 检查地图状态
debugMap();

// 手动初始化地图
initMap();

// 强制重新初始化
reinitMap();
```

### 步骤3: 检查网络请求
在Network标签页中确认Leaflet库是否成功加载

## 🧪 使用测试页面

我已经创建了一个专门的地图测试页面 `map-test.html`，你可以：

1. 打开 `map-test.html` 页面
2. 使用页面上的按钮测试各项功能
3. 查看实时状态信息
4. 对比与主页面的差异

## 🚀 快速修复方案

### 方案1: 延迟初始化
```javascript
// 在script-new.js中增加延迟时间
setTimeout(() => {
    if (mapManager) {
        mapManager.setupTravelMap();
    }
}, 2000); // 增加到2秒
```

### 方案2: 手动触发初始化
```javascript
// 在页面加载完成后手动触发
window.addEventListener('load', function() {
    if (window.mapManager) {
        window.mapManager.manualInit();
    }
});
```

### 方案3: 检查依赖库
```javascript
// 在控制台中检查
console.log('Leaflet版本:', L?.version);
console.log('MapManager:', typeof MapManager);
console.log('地图容器:', document.getElementById('map'));
```

## 📋 检查清单

- [ ] Leaflet CSS 已加载
- [ ] Leaflet JavaScript 已加载
- [ ] 地图容器元素存在
- [ ] MapManager类已定义
- [ ] 页面完全加载
- [ ] 网络连接正常
- [ ] 控制台无错误

## 🆘 紧急解决方案

如果地图仍然无法加载，请尝试：

1. **刷新页面** - 有时是临时网络问题
2. **清除浏览器缓存** - 清除旧的脚本缓存
3. **使用无痕模式** - 排除扩展程序干扰
4. **检查网络连接** - 确保能访问unpkg.com
5. **降级Leaflet版本** - 尝试使用1.8.0版本

## 📞 获取帮助

如果问题仍然存在，请：

1. 打开浏览器控制台
2. 运行 `debugMap()` 命令
3. 复制所有错误信息
4. 提供错误截图
5. 说明使用的浏览器和版本

## 🎯 预期结果

成功加载后，你应该看到：

- ✅ 地图正常显示
- ✅ 城市标记可见
- ✅ 控制面板显示
- ✅ 可以缩放和移动地图
- ✅ 悬停显示城市信息
- ✅ 点击显示城市详情

---

**💡 提示**: 大多数地图加载问题都与脚本加载顺序或网络连接有关。按照上述步骤逐一检查，通常能快速解决问题！
