<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐盛宴网站 - 修复验证页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        #console-output {
            height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>🎵 音乐盛宴网站 - 修复验证页面</h1>
    
    <div class="test-section">
        <h2>✅ 已修复的问题</h2>
        <ul>
            <li class="success">变量重复声明错误 - 已修复</li>
            <li class="success">script-new.js 文件缺失 - 已恢复</li>
            <li class="success">博客系统类名引用错误 - 已修正</li>
            <li class="success">模块初始化冲突 - 已解决</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>🧪 功能测试</h2>
        <button onclick="testVariableDeclaration()">测试变量声明</button>
        <button onclick="testModuleLoading()">测试模块加载</button>
        <button onclick="testBlogSystem()">测试博客系统</button>
        <button onclick="clearConsole()">清空控制台</button>
    </div>
    
    <div class="test-section">
        <h2>📊 控制台输出</h2>
        <div id="console-output"></div>
    </div>
    
    <div class="test-section">
        <h2>🔧 技术说明</h2>
        <p>修复内容：</p>
        <ul>
            <li>将 <code>let</code> 改为 <code>var</code> 避免重复声明错误</li>
            <li>移除了 <code>blog-system.js</code> 中的重复初始化代码</li>
            <li>统一由 <code>script-new.js</code> 管理所有模块初始化</li>
            <li>避免了多个脚本同时声明同一变量的问题</li>
        </ul>
    </div>

    <script>
        // 重写console.log来捕获输出
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addToConsole(type, message) {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#f87171' : type === 'warn' ? '#fbbf24' : '#60a5fa';
            div.innerHTML = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('log', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('warn', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('error', args.join(' '));
        };
        
        // 测试变量声明
        function testVariableDeclaration() {
            console.log('🧪 测试变量声明...');
            
            try {
                // 尝试声明可能冲突的变量
                var testVar1 = 'test1';
                var testVar2 = 'test2';
                var testVar3 = 'test3';
                
                console.log('✅ 变量声明测试通过');
                console.log('testVar1:', testVar1);
                console.log('testVar2:', testVar2);
                console.log('testVar3:', testVar3);
                
                // 测试全局变量是否可用
                if (typeof window.projectManager !== 'undefined') {
                    console.log('✅ projectManager 全局变量可用');
                } else {
                    console.log('⚠️ projectManager 全局变量未定义');
                }
                
            } catch (error) {
                console.error('❌ 变量声明测试失败:', error);
            }
        }
        
        // 测试模块加载
        function testModuleLoading() {
            console.log('🧪 测试模块加载...');
            
            const modules = [
                'ProjectManager',
                'SkillVisualizer',
                'TimelineManager',
                'OptimizedBlogSystem',
                'MapManager',
                'ThemeManager',
                'UIEffectsManager',
                'MusicWebsiteCore'
            ];
            
            let loadedCount = 0;
            modules.forEach(moduleName => {
                if (typeof window[moduleName] !== 'undefined') {
                    loadedCount++;
                    console.log(`✅ ${moduleName} 已加载`);
                } else {
                    console.log(`❌ ${moduleName} 未加载`);
                }
            });
            
            console.log(`📊 模块加载统计: ${loadedCount}/${modules.length}`);
            
            if (loadedCount === modules.length) {
                console.log('🎉 所有模块加载完成！');
            } else {
                console.log('⚠️ 部分模块未加载，请检查脚本引用');
            }
        }
        
        // 测试博客系统
        function testBlogSystem() {
            console.log('🧪 测试博客系统...');
            
            if (typeof window.OptimizedBlogSystem !== 'undefined') {
                console.log('✅ OptimizedBlogSystem 类可用');
                
                try {
                    // 尝试创建博客系统实例
                    const blogSystem = new window.OptimizedBlogSystem();
                    console.log('✅ 博客系统实例创建成功');
                    console.log('博客系统实例:', blogSystem);
                    
                    // 检查实例方法
                    if (blogSystem.loadPosts) {
                        console.log('✅ loadPosts 方法可用');
                    }
                    if (blogSystem.renderBlogInterface) {
                        console.log('✅ renderBlogInterface 方法可用');
                    }
                    
                } catch (error) {
                    console.error('❌ 博客系统实例创建失败:', error);
                }
                
            } else {
                console.error('❌ OptimizedBlogSystem 类不可用');
            }
        }
        
        // 清空控制台
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }
        
        // 页面加载完成后的检查
        window.addEventListener('load', () => {
            console.log('🎵 修复验证页面加载完成');
            console.log('📝 当前环境:', window.location.protocol);
            console.log('🌐 建议：使用测试按钮来验证修复效果');
            
            // 自动测试模块加载
            setTimeout(testModuleLoading, 1000);
        });
        
        // 捕获全局错误
        window.addEventListener('error', (event) => {
            console.error('❌ 全局错误:', event.error);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('❌ 未处理的Promise拒绝:', event.reason);
        });
    </script>
</body>
</html>
